import{d as G,r as W,N as re,c as $,O as V,o as he,Q as Ve,M as We,e as xe,z as R,P as fe,H as we,W as be,X as ye}from"./C8-PzCqa.js";import{c as ee,I as Oe,J as Ze,x as ke,w as Re,l as Te,K as Ne,h as Me,t as _,n as Q,p as N,F as se,j as pe,L as ie,M as Z,q as ve,E as qe,v as ne,r as Ge,k as De,G as oe,N as Ue,D as Ce,m as J,i as Ke,e as de,H as ze,z as Je,O as Qe,P as et}from"./BuLWTQJ-.js";import{k as Ae,d as te,o as tt,L as Ee,l as at,P as nt,H as ot,f as Be,m as it,n as lt,F as rt}from"./DIaV-xco.js";import{I as le}from"./CugIzq5t.js";import{s as st}from"./8UUFJmno.js";const[ct,B,ut]=ee("uploader");function Pe(e,h){return new Promise(y=>{if(h==="file"){y();return}const l=new FileReader;l.onload=d=>{y(d.target.result)},h==="dataUrl"?l.readAsDataURL(e):h==="text"&&l.readAsText(e)})}function je(e,h){return Oe(e).some(y=>y.file?Ze(h)?h(y.file):y.file.size>+h:!1)}function dt(e,h){const y=[],l=[];return e.forEach(d=>{je(d,h)?l.push(d):y.push(d)}),{valid:y,invalid:l}}const ft=/\.(jpeg|jpg|gif|png|svg|webp|jfif|bmp|dpg|avif)/i,vt=e=>ft.test(e);function Fe(e){return e.isImage?!0:e.file&&e.file.type?e.file.type.indexOf("image")===0:e.url?vt(e.url):typeof e.content=="string"?e.content.indexOf("data:image")===0:!1}const[_e,ce]=ee("swipe"),mt={loop:_,width:Q,height:Q,vertical:Boolean,autoplay:N(0),duration:N(500),touchable:_,lazyRender:Boolean,initialSwipe:N(0),indicatorColor:String,showIndicators:_,stopPropagation:_},$e=Symbol(_e);var gt=G({name:_e,props:mt,emits:["change","dragStart","dragEnd"],setup(e,{emit:h,slots:y}){const l=W(),d=W(),o=re({rect:null,width:0,height:0,offset:0,active:0,swiping:!1});let p=!1;const I=Ae(),{children:m,linkChildren:M}=ke($e),s=$(()=>m.length),C=$(()=>o[e.vertical?"height":"width"]),S=$(()=>e.vertical?I.deltaY.value:I.deltaX.value),P=$(()=>o.rect?(e.vertical?o.rect.height:o.rect.width)-C.value*s.value:0),z=$(()=>C.value?Math.ceil(Math.abs(P.value)/C.value):s.value),a=$(()=>s.value*C.value),t=$(()=>(o.active+s.value)%s.value),n=$(()=>{const g=e.vertical?"vertical":"horizontal";return I.direction.value===g}),i=$(()=>{const g={transitionDuration:`${o.swiping?0:e.duration}ms`,transform:`translate${e.vertical?"Y":"X"}(${+o.offset.toFixed(2)}px)`};if(C.value){const A=e.vertical?"height":"width",E=e.vertical?"width":"height";g[A]=`${a.value}px`,g[E]=e[E]?`${e[E]}px`:""}return g}),r=g=>{const{active:A}=o;return g?e.loop?Z(A+g,-1,s.value):Z(A+g,0,z.value):A},f=(g,A=0)=>{let E=g*C.value;e.loop||(E=Math.min(E,-P.value));let Y=A-E;return e.loop||(Y=Z(Y,P.value,0)),Y},w=({pace:g=0,offset:A=0,emitChange:E})=>{if(s.value<=1)return;const{active:Y}=o,X=r(g),ae=f(X,A);if(e.loop){if(m[0]&&ae!==P.value){const me=ae<P.value;m[0].setOffset(me?a.value:0)}if(m[s.value-1]&&ae!==0){const me=ae>0;m[s.value-1].setOffset(me?-a.value:0)}}o.active=X,o.offset=ae,E&&X!==Y&&h("change",t.value)},u=()=>{o.swiping=!0,o.active<=-1?w({pace:s.value}):o.active>=s.value&&w({pace:-s.value})},x=()=>{u(),I.reset(),se(()=>{o.swiping=!1,w({pace:-1,emitChange:!0})})},c=()=>{u(),I.reset(),se(()=>{o.swiping=!1,w({pace:1,emitChange:!0})})};let b;const T=()=>clearTimeout(b),k=()=>{T(),+e.autoplay>0&&s.value>1&&(b=setTimeout(()=>{c(),k()},+e.autoplay))},U=(g=+e.initialSwipe)=>{if(!l.value)return;const A=()=>{var E,Y;if(!pe(l)){const X={width:l.value.offsetWidth,height:l.value.offsetHeight};o.rect=X,o.width=+((E=e.width)!=null?E:X.width),o.height=+((Y=e.height)!=null?Y:X.height)}s.value&&(g=Math.min(s.value-1,g),g===-1&&(g=s.value-1)),o.active=g,o.swiping=!0,o.offset=f(g),m.forEach(X=>{X.setOffset(0)}),k()};pe(l)?fe().then(A):A()},j=()=>U(o.active);let H;const q=g=>{!e.touchable||g.touches.length>1||(I.start(g),p=!1,H=Date.now(),T(),u())},v=g=>{e.touchable&&o.swiping&&(I.move(g),n.value&&(!e.loop&&(o.active===0&&S.value>0||o.active===s.value-1&&S.value<0)||(ie(g,e.stopPropagation),w({offset:S.value}),p||(h("dragStart",{index:t.value}),p=!0))))},O=()=>{if(!e.touchable||!o.swiping)return;const g=Date.now()-H,A=S.value/g;if((Math.abs(A)>.25||Math.abs(S.value)>C.value/2)&&n.value){const Y=e.vertical?I.offsetY.value:I.offsetX.value;let X=0;e.loop?X=Y>0?S.value>0?-1:1:0:X=-Math[S.value>0?"ceil":"floor"](S.value/C.value),w({pace:X,emitChange:!0})}else S.value&&w({pace:0});p=!1,o.swiping=!1,h("dragEnd",{index:t.value}),k()},D=(g,A={})=>{u(),I.reset(),se(()=>{let E;e.loop&&g===s.value?E=o.active===0?0:g:E=g%s.value,A.immediate?se(()=>{o.swiping=!1}):o.swiping=!1,w({pace:E-o.active,emitChange:!0})})},F=(g,A)=>{const E=A===t.value,Y=E?{backgroundColor:e.indicatorColor}:void 0;return R("i",{style:Y,class:ce("indicator",{active:E})},null)},L=()=>{if(y.indicator)return y.indicator({active:t.value,total:s.value});if(e.showIndicators&&s.value>1)return R("div",{class:ce("indicators",{vertical:e.vertical})},[Array(s.value).fill("").map(F)])};return te({prev:x,next:c,state:o,resize:j,swipeTo:D}),M({size:C,props:e,count:s,activeIndicator:t}),V(()=>e.initialSwipe,g=>U(+g)),V(s,()=>U(o.active)),V(()=>e.autoplay,k),V([Re,Te,()=>e.width,()=>e.height],j),V(Ne(),g=>{g==="visible"?k():T()}),he(U),Ve(()=>U(o.active)),tt(()=>U(o.active)),We(T),xe(T),Me("touchmove",v,{target:d}),()=>{var g;return R("div",{ref:l,class:ce()},[R("div",{ref:d,style:i.value,class:ce("track",{vertical:e.vertical}),onTouchstartPassive:q,onTouchend:O,onTouchcancel:O},[(g=y.default)==null?void 0:g.call(y)]),L()])}}});const ht=ve(gt),Le=ve(st),[wt,bt]=ee("swipe-item");var yt=G({name:wt,setup(e,{slots:h}){let y;const l=re({offset:0,inited:!1,mounted:!1}),{parent:d,index:o}=qe($e);if(!d)return;const p=$(()=>{const M={},{vertical:s}=d.props;return d.size.value&&(M[s?"height":"width"]=`${d.size.value}px`),l.offset&&(M.transform=`translate${s?"Y":"X"}(${l.offset}px)`),M}),I=$(()=>{const{loop:M,lazyRender:s}=d.props;if(!s||y)return!0;if(!l.mounted)return!1;const C=d.activeIndicator.value,S=d.count.value-1,P=C===0&&M?S:C-1,z=C===S&&M?0:C+1;return y=o.value===C||o.value===P||o.value===z,y}),m=M=>{l.offset=M};return he(()=>{fe(()=>{l.mounted=!0})}),te({setOffset:m}),()=>{var M;return R("div",{class:bt(),style:p.value},[I.value?(M=h.default)==null?void 0:M.call(h):null])}}});const pt=ve(yt),Ie=e=>Math.sqrt((e[0].clientX-e[1].clientX)**2+(e[0].clientY-e[1].clientY)**2),Ct=e=>({x:(e[0].clientX+e[1].clientX)/2,y:(e[0].clientY+e[1].clientY)/2}),ge=ee("image-preview")[1],Se=2.6,Pt={src:String,show:Boolean,active:Number,minZoom:ne(Q),maxZoom:ne(Q),rootWidth:ne(Number),rootHeight:ne(Number),disableZoom:Boolean,doubleScale:Boolean,closeOnClickImage:Boolean,closeOnClickOverlay:Boolean,vertical:Boolean};var It=G({props:Pt,emits:["scale","close","longPress"],setup(e,{emit:h,slots:y}){const l=re({scale:1,moveX:0,moveY:0,moving:!1,zooming:!1,initializing:!1,imageRatio:0}),d=Ae(),o=W(),p=W(),I=W(!1),m=W(!1);let M=0;const s=$(()=>{const{scale:v,moveX:O,moveY:D,moving:F,zooming:L,initializing:g}=l,A={transitionDuration:L||F||g?"0s":".3s"};return(v!==1||m.value)&&(A.transform=`matrix(${v}, 0, 0, ${v}, ${O}, ${D})`),A}),C=$(()=>{if(l.imageRatio){const{rootWidth:v,rootHeight:O}=e,D=I.value?O/l.imageRatio:v;return Math.max(0,(l.scale*D-v)/2)}return 0}),S=$(()=>{if(l.imageRatio){const{rootWidth:v,rootHeight:O}=e,D=I.value?O:v*l.imageRatio;return Math.max(0,(l.scale*D-O)/2)}return 0}),P=(v,O)=>{var D;if(v=Z(v,+e.minZoom,+e.maxZoom+1),v!==l.scale){const F=v/l.scale;if(l.scale=v,O){const L=De((D=o.value)==null?void 0:D.$el),g={x:L.width*.5,y:L.height*.5},A=l.moveX-(O.x-L.left-g.x)*(F-1),E=l.moveY-(O.y-L.top-g.y)*(F-1);l.moveX=Z(A,-C.value,C.value),l.moveY=Z(E,-S.value,S.value)}else l.moveX=0,l.moveY=m.value?M:0;h("scale",{scale:v,index:e.active})}},z=()=>{P(1)},a=()=>{const v=l.scale>1?1:2;P(v,v===2||m.value?{x:d.startX.value,y:d.startY.value}:void 0)};let t,n,i,r,f,w,u,x,c=!1;const b=v=>{const{touches:O}=v;if(t=O.length,t===2&&e.disableZoom)return;const{offsetX:D}=d;d.start(v),n=l.moveX,i=l.moveY,x=Date.now(),c=!1,l.moving=t===1&&(l.scale!==1||m.value),l.zooming=t===2&&!D.value,l.zooming&&(r=l.scale,f=Ie(O))},T=v=>{const{touches:O}=v;if(d.move(v),l.moving){const{deltaX:D,deltaY:F}=d,L=D.value+n,g=F.value+i;if((e.vertical?d.isVertical()&&Math.abs(g)>S.value:d.isHorizontal()&&Math.abs(L)>C.value)&&!c){l.moving=!1;return}c=!0,ie(v,!0),l.moveX=Z(L,-C.value,C.value),l.moveY=Z(g,-S.value,S.value)}if(l.zooming&&(ie(v,!0),O.length===2)){const D=Ie(O),F=r*D/f;w=Ct(O),P(F,w)}},k=v=>{var O;const D=(O=p.value)==null?void 0:O.$el;if(!D)return;const F=D.firstElementChild,L=v.target===D,g=F==null?void 0:F.contains(v.target);!e.closeOnClickImage&&g||!e.closeOnClickOverlay&&L||h("close")},U=v=>{if(t>1)return;const O=Date.now()-x,D=250;d.isTap.value&&(O<D?e.doubleScale?u?(clearTimeout(u),u=null,a()):u=setTimeout(()=>{k(v),u=null},D):k(v):O>at&&h("longPress"))},j=v=>{let O=!1;if((l.moving||l.zooming)&&(O=!0,l.moving&&n===l.moveX&&i===l.moveY&&(O=!1),!v.touches.length)){l.zooming&&(l.moveX=Z(l.moveX,-C.value,C.value),l.moveY=Z(l.moveY,-S.value,S.value),l.zooming=!1),l.moving=!1,n=0,i=0,r=1,l.scale<1&&z();const D=+e.maxZoom;l.scale>D&&P(D,w)}ie(v,O),U(v),d.reset()},H=()=>{const{rootWidth:v,rootHeight:O}=e,D=O/v,{imageRatio:F}=l;I.value=l.imageRatio>D&&F<Se,m.value=l.imageRatio>D&&F>=Se,m.value&&(M=(F*v-O)/2,l.moveY=M,l.initializing=!0,Ge(()=>{l.initializing=!1})),z()},q=v=>{const{naturalWidth:O,naturalHeight:D}=v.target;l.imageRatio=D/O,H()};return V(()=>e.active,z),V(()=>e.show,v=>{v||z()}),V(()=>[e.rootWidth,e.rootHeight],H),Me("touchmove",T,{target:$(()=>{var v;return(v=p.value)==null?void 0:v.$el})}),te({resetScale:z}),()=>{const v={loading:()=>R(Ee,{type:"spinner"},null)};return R(pt,{ref:p,class:ge("swipe-item"),onTouchstartPassive:b,onTouchend:j,onTouchcancel:j},{default:()=>[y.image?R("div",{class:ge("image-wrap")},[y.image({src:e.src,onLoad:q,style:s.value})]):R(Le,{ref:o,src:e.src,fit:"contain",class:ge("image",{vertical:I.value}),style:s.value,onLoad:q},v)]})}}});const[St,K]=ee("image-preview"),xt=["show","teleport","transition","overlayStyle","closeOnPopstate"],Ot={show:Boolean,loop:_,images:Ue(),minZoom:N(1/3),maxZoom:N(3),overlay:_,vertical:Boolean,closeable:Boolean,showIndex:_,className:Ce,closeIcon:J("clear"),transition:String,beforeClose:Function,doubleScale:_,overlayClass:Ce,overlayStyle:Object,swipeDuration:N(300),startPosition:N(0),showIndicators:Boolean,closeOnPopstate:_,closeOnClickImage:_,closeOnClickOverlay:_,closeIconPosition:J("top-right"),teleport:[String,Object]};var Xe=G({name:St,props:Ot,emits:["scale","close","closed","change","longPress","update:show"],setup(e,{emit:h,slots:y}){const l=W(),d=W(),o=re({active:0,rootWidth:0,rootHeight:0,disableZoom:!1}),p=()=>{if(l.value){const r=De(l.value.$el);o.rootWidth=r.width,o.rootHeight=r.height,l.value.resize()}},I=r=>h("scale",r),m=r=>h("update:show",r),M=()=>{Be(e.beforeClose,{args:[o.active],done:()=>m(!1)})},s=r=>{r!==o.active&&(o.active=r,h("change",r))},C=()=>{if(e.showIndex)return R("div",{class:K("index")},[y.index?y.index({index:o.active}):`${o.active+1} / ${e.images.length}`])},S=()=>{if(y.cover)return R("div",{class:K("cover")},[y.cover()])},P=()=>{o.disableZoom=!0},z=()=>{o.disableZoom=!1},a=()=>R(ht,{ref:l,lazyRender:!0,loop:e.loop,class:K("swipe"),vertical:e.vertical,duration:e.swipeDuration,initialSwipe:e.startPosition,showIndicators:e.showIndicators,indicatorColor:"white",onChange:s,onDragEnd:z,onDragStart:P},{default:()=>[e.images.map((r,f)=>R(It,{ref:w=>{f===o.active&&(d.value=w)},src:r,show:e.show,active:o.active,maxZoom:e.maxZoom,minZoom:e.minZoom,rootWidth:o.rootWidth,rootHeight:o.rootHeight,disableZoom:o.disableZoom,doubleScale:e.doubleScale,closeOnClickImage:e.closeOnClickImage,closeOnClickOverlay:e.closeOnClickOverlay,vertical:e.vertical,onScale:I,onClose:M,onLongPress:()=>h("longPress",{index:f})},{image:y.image}))]}),t=()=>{if(e.closeable)return R(le,{role:"button",name:e.closeIcon,class:[K("close-icon",e.closeIconPosition),ot],onClick:M},null)},n=()=>h("closed"),i=(r,f)=>{var w;return(w=l.value)==null?void 0:w.swipeTo(r,f)};return te({resetScale:()=>{var r;(r=d.value)==null||r.resetScale()},swipeTo:i}),he(p),V([Re,Te],p),V(()=>e.startPosition,r=>s(+r)),V(()=>e.show,r=>{const{images:f,startPosition:w}=e;r?(s(+w),fe(()=>{p(),i(+w,{immediate:!0})})):h("close",{index:o.active,url:f[o.active]})}),()=>R(nt,we({class:[K(),e.className],overlayClass:[K("overlay"),e.overlayClass],onClosed:n,"onUpdate:show":m},oe(e,xt)),{default:()=>[t(),a(),C(),S()]})}});let ue;const kt={loop:!0,images:[],maxZoom:3,minZoom:1/3,onScale:void 0,onClose:void 0,onChange:void 0,vertical:!1,teleport:"body",className:"",showIndex:!0,closeable:!1,closeIcon:"clear",transition:void 0,beforeClose:void 0,doubleScale:!0,overlayStyle:void 0,overlayClass:void 0,startPosition:0,swipeDuration:300,showIndicators:!1,closeOnPopstate:!0,closeOnClickOverlay:!0,closeIconPosition:"top-right"};function Rt(){({instance:ue}=it({setup(){const{state:e,toggle:h}=lt(),y=()=>{e.images=[]};return()=>R(Xe,we(e,{onClosed:y,"onUpdate:show":h}),null)}}))}const Tt=(e,h=0)=>{if(Ke)return ue||Rt(),e=Array.isArray(e)?{images:e,startPosition:h}:e,ue.open(de({},kt,e)),ue};ve(Xe);var Mt=G({props:{name:Q,item:ne(Object),index:Number,imageFit:String,lazyLoad:Boolean,deletable:Boolean,reupload:Boolean,previewSize:[Number,String,Array],beforeDelete:Function},emits:["delete","preview","reupload"],setup(e,{emit:h,slots:y}){const l=()=>{const{status:s,message:C}=e.item;if(s==="uploading"||s==="failed"){const S=s==="failed"?R(le,{name:"close",class:B("mask-icon")},null):R(Ee,{class:B("loading")},null),P=Je(C)&&C!=="";return R("div",{class:B("mask")},[S,P&&R("div",{class:B("mask-message")},[C])])}},d=s=>{const{name:C,item:S,index:P,beforeDelete:z}=e;s.stopPropagation(),Be(z,{args:[S,{name:C,index:P}],done:()=>h("delete")})},o=()=>h("preview"),p=()=>h("reupload"),I=()=>{if(e.deletable&&e.item.status!=="uploading"){const s=y["preview-delete"];return R("div",{role:"button",class:B("preview-delete",{shadow:!s}),tabindex:0,"aria-label":ut("delete"),onClick:d},[s?s():R(le,{name:"cross",class:B("preview-delete-icon")},null)])}},m=()=>{if(y["preview-cover"]){const{index:s,item:C}=e;return R("div",{class:B("preview-cover")},[y["preview-cover"](de({index:s},C))])}},M=()=>{const{item:s,lazyLoad:C,imageFit:S,previewSize:P,reupload:z}=e;return Fe(s)?R(Le,{fit:S,src:s.objectUrl||s.content||s.url,class:B("preview-image"),width:Array.isArray(P)?P[0]:P,height:Array.isArray(P)?P[1]:P,lazyLoad:C,onClick:z?p:o},{default:m}):R("div",{class:B("file"),style:ze(e.previewSize)},[R(le,{class:B("file-icon"),name:"description"},null),R("div",{class:[B("file-name"),"van-ellipsis"]},[s.file?s.file.name:s.url]),m()])};return()=>R("div",{class:B("preview")},[M(),l(),I()])}});const Dt={name:N(""),accept:J("image/*"),capture:String,multiple:Boolean,disabled:Boolean,readonly:Boolean,lazyLoad:Boolean,maxCount:N(1/0),imageFit:J("cover"),resultType:J("dataUrl"),uploadIcon:J("photograph"),uploadText:String,deletable:_,reupload:Boolean,afterRead:Function,showUpload:_,modelValue:Ue(),beforeRead:Function,beforeDelete:Function,previewSize:[Number,String,Array],previewImage:_,previewOptions:Object,previewFullImage:_,maxSize:{type:[Number,String,Function],default:1/0}};var Yt=G({name:ct,props:Dt,emits:["delete","oversize","clickUpload","closePreview","clickPreview","clickReupload","update:modelValue"],setup(e,{emit:h,slots:y}){const l=W(),d=[],o=W(-1),p=W(!1),I=(c=e.modelValue.length)=>({name:e.name,index:c}),m=()=>{l.value&&(l.value.value="")},M=c=>{if(m(),je(c,e.maxSize))if(Array.isArray(c)){const b=dt(c,e.maxSize);if(c=b.valid,h("oversize",b.invalid,I()),!c.length)return}else{h("oversize",c,I());return}if(c=re(c),o.value>-1){const b=[...e.modelValue];b.splice(o.value,1,c),h("update:modelValue",b),o.value=-1}else h("update:modelValue",[...e.modelValue,...Oe(c)]);e.afterRead&&e.afterRead(c,I())},s=c=>{const{maxCount:b,modelValue:T,resultType:k}=e;if(Array.isArray(c)){const U=+b-T.length;c.length>U&&(c=c.slice(0,U)),Promise.all(c.map(j=>Pe(j,k))).then(j=>{const H=c.map((q,v)=>{const O={file:q,status:"",message:"",objectUrl:URL.createObjectURL(q)};return j[v]&&(O.content=j[v]),O});M(H)})}else Pe(c,k).then(U=>{const j={file:c,status:"",message:"",objectUrl:URL.createObjectURL(c)};U&&(j.content=U),M(j)})},C=c=>{const{files:b}=c.target;if(e.disabled||!b||!b.length)return;const T=b.length===1?b[0]:[].slice.call(b);if(e.beforeRead){const k=e.beforeRead(T,I());if(!k){m();return}if(et(k)){k.then(U=>{s(U||T)}).catch(m);return}}s(T)};let S;const P=()=>h("closePreview"),z=c=>{if(e.previewFullImage){const b=e.modelValue.filter(Fe),T=b.map(k=>(k.objectUrl&&!k.url&&k.status!=="failed"&&(k.url=k.objectUrl,d.push(k.url)),k.url)).filter(Boolean);S=Tt(de({images:T,startPosition:b.indexOf(c),onClose:P},e.previewOptions))}},a=()=>{S&&S.close()},t=(c,b)=>{const T=e.modelValue.slice(0);T.splice(b,1),h("update:modelValue",T),h("delete",c,I(b))},n=c=>{p.value=!0,o.value=c,fe(()=>x())},i=()=>{p.value||(o.value=-1),p.value=!1},r=(c,b)=>{const T=["imageFit","deletable","reupload","previewSize","beforeDelete"],k=de(oe(e,T),oe(c,T,!0));return R(Mt,we({item:c,index:b,onClick:()=>h(e.reupload?"clickReupload":"clickPreview",c,I(b)),onDelete:()=>t(c,b),onPreview:()=>z(c),onReupload:()=>n(b)},oe(e,["name","lazyLoad"]),k),oe(y,["preview-cover","preview-delete"]))},f=()=>{if(e.previewImage)return e.modelValue.map(r)},w=c=>h("clickUpload",c),u=()=>{if(e.modelValue.length>=+e.maxCount&&!e.reupload)return;const c=e.modelValue.length>=+e.maxCount&&e.reupload,b=e.readonly?null:R("input",{ref:l,type:"file",class:B("input"),accept:e.accept,capture:e.capture,multiple:e.multiple&&o.value===-1,disabled:e.disabled,onChange:C,onClick:i},null);return y.default?be(R("div",{class:B("input-wrapper"),onClick:w},[y.default(),b]),[[ye,!c]]):be(R("div",{class:B("upload",{readonly:e.readonly}),style:ze(e.previewSize),onClick:w},[R(le,{name:e.uploadIcon,class:B("upload-icon")},null),e.uploadText&&R("span",{class:B("upload-text")},[e.uploadText]),b]),[[ye,e.showUpload&&!c]])},x=()=>{l.value&&!e.disabled&&l.value.click()};return xe(()=>{d.forEach(c=>URL.revokeObjectURL(c))}),te({chooseFile:x,closeImagePreview:a}),Qe(()=>e.modelValue),()=>R("div",{class:B()},[R("div",{class:B("wrapper",{disabled:e.disabled})},[f(),u()])])}});const[Ut,zt]=ee("form"),At={colon:Boolean,disabled:Boolean,readonly:Boolean,required:[Boolean,String],showError:Boolean,labelWidth:Q,labelAlign:String,inputAlign:String,scrollToError:Boolean,validateFirst:Boolean,submitOnEnter:_,showErrorMessage:_,errorMessageAlign:String,validateTrigger:{type:[String,Array],default:"onBlur"}};var Ht=G({name:Ut,props:At,emits:["submit","failed"],setup(e,{emit:h,slots:y}){const{children:l,linkChildren:d}=ke(rt),o=t=>t?l.filter(n=>t.includes(n.name)):l,p=t=>new Promise((n,i)=>{const r=[];o(t).reduce((w,u)=>w.then(()=>{if(!r.length)return u.validate().then(x=>{x&&r.push(x)})}),Promise.resolve()).then(()=>{r.length?i(r):n()})}),I=t=>new Promise((n,i)=>{const r=o(t);Promise.all(r.map(f=>f.validate())).then(f=>{f=f.filter(Boolean),f.length?i(f):n()})}),m=t=>{const n=l.find(i=>i.name===t);return n?new Promise((i,r)=>{n.validate().then(f=>{f?r(f):i()})}):Promise.reject()},M=t=>typeof t=="string"?m(t):e.validateFirst?p(t):I(t),s=t=>{typeof t=="string"&&(t=[t]),o(t).forEach(i=>{i.resetValidation()})},C=()=>l.reduce((t,n)=>(t[n.name]=n.getValidationStatus(),t),{}),S=(t,n)=>{l.some(i=>i.name===t?(i.$el.scrollIntoView(n),!0):!1)},P=()=>l.reduce((t,n)=>(n.name!==void 0&&(t[n.name]=n.formValue.value),t),{}),z=()=>{const t=P();M().then(()=>h("submit",t)).catch(n=>{h("failed",{values:t,errors:n}),e.scrollToError&&n[0].name&&S(n[0].name)})},a=t=>{ie(t),z()};return d({props:e}),te({submit:z,validate:M,getValues:P,scrollToField:S,resetValidation:s,getValidationStatus:C}),()=>{var t;return R("form",{class:zt(),onSubmit:a},[(t=y.default)==null?void 0:t.call(y)])}}});function Et(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var Ye={exports:{}},He={exports:{}};(function(e,h){(function(y,l){e.exports=l()})(window,function(){return function(y){var l={};function d(o){if(l[o])return l[o].exports;var p=l[o]={i:o,l:!1,exports:{}};return y[o].call(p.exports,p,p.exports,d),p.l=!0,p.exports}return d.m=y,d.c=l,d.d=function(o,p,I){d.o(o,p)||Object.defineProperty(o,p,{enumerable:!0,get:I})},d.r=function(o){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(o,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(o,"__esModule",{value:!0})},d.t=function(o,p){if(1&p&&(o=d(o)),8&p||4&p&&typeof o=="object"&&o&&o.__esModule)return o;var I=Object.create(null);if(d.r(I),Object.defineProperty(I,"default",{enumerable:!0,value:o}),2&p&&typeof o!="string")for(var m in o)d.d(I,m,(function(M){return o[M]}).bind(null,m));return I},d.n=function(o){var p=o&&o.__esModule?function(){return o.default}:function(){return o};return d.d(p,"a",p),p},d.o=function(o,p){return Object.prototype.hasOwnProperty.call(o,p)},d.p="",d(d.s=0)}([function(y,l,d){d.r(l);var o=window,p=/^image\//,I=/\.\w+$/,m={},M={file:null,quality:.8,convertSize:2048e3,loose:!0,redressOrientation:!0},s=function(a){return typeof a=="function"},C=function(a){return p.test(a)};function S(a){a=Object.assign({},M,a),this.options=a,this.file=a.file,this.image=null,this.ParsedOrientationInfo=null,this.init()}var P=S.prototype;for(var z in l.default=S,P.init=function(){var a=this,t=this.file,n=this.options;t&&C(t.type)?(C(n.mimeType)||(n.mimeType=t.type),m.file2Image(t,function(i){s(a.beforeCompress)&&(a.image=i,t.width=i.naturalWidth,t.height=i.naturalHeight,a.beforeCompress(t)),t.type==="image/jpeg"&&n.redressOrientation?a.getParsedOrientationInfo(function(r){a.parsedOrientationInfo=r,a.rendCanvas()}):(a.parsedOrientationInfo={rotate:0,scaleX:1,scaleY:1},a.rendCanvas())},a.error)):a.error("请上传图片文件!")},P.rendCanvas=function(){var a=this,t=this.options,n=this.image,i=this.getExpectedEdge(),r=i.dWidth,f=i.dHeight,w=i.width,u=i.height,x=m.image2Canvas(n,r,f,a.beforeDraw.bind(a),a.afterDraw.bind(a),w,u);m.canvas2Blob(x,function(c){c&&(c.width=x.width,c.height=x.height),a.success(c)},t.quality,t.mimeType)},P.beforeCompress=function(){s(this.options.beforeCompress)&&this.options.beforeCompress(this.file)},P.getExpectedEdge=function(){var a,t=this.image,n=this.parsedOrientationInfo.rotate,i=this.options,r=t.naturalWidth,f=t.naturalHeight,w=Math.abs(n)%180==90;w&&(a=f,f=r,r=a);var u=r/f,x=Math.max(i.maxWidth,0)||1/0,c=Math.max(i.maxHeight,0)||1/0,b=Math.max(i.minWidth,0)||0,T=Math.max(i.minHeight,0)||0,k=Math.max(i.width,0)||r,U=Math.max(i.height,0)||f;x<1/0&&c<1/0?c*u>x?c=x/u:x=c*u:x<1/0?c=x/u:c<1/0&&(x=c*u),b>0&&T>0?T*u>b?T=b/u:b=T*u:b>0?T=b/u:T>0&&(b=T*u),U*u>k?U=k/u:k=U*u;var j=k=Math.floor(Math.min(Math.max(k,b),x)),H=U=Math.floor(Math.min(Math.max(U,T),c));return w&&(a=H,H=j,j=a),{dWidth:j,dHeight:H,width:k,height:U}},P.getParsedOrientationInfo=function(a){var t=this;this.getOrientation(function(n){s(a)&&a(t.parseOrientation(n))})},P.getOrientation=function(a){var t=this;m.file2ArrayBuffer(this.file,function(n){s(a)&&a(t.resetAndGetOrientation(n))})},P.resetAndGetOrientation=function(a){var t,n=new DataView(a);try{var i,r,f;if(n.getUint8(0)===255&&n.getUint8(1)===216)for(var w=n.byteLength,u=2;u+1<w;){if(n.getUint8(u)===255&&n.getUint8(u+1)===225){r=u;break}u+=1}if(r){var x=r+4,c=r+10;if(m.getStringFromCharCode(n,x,4)==="Exif"){var b=n.getUint16(c);if(((i=b===18761)||b===19789)&&n.getUint16(c+2,i)===42){var T=n.getUint32(c+4,i);T>=8&&(f=c+T)}}}if(f){var k;for(w=n.getUint16(f,i),k=0;k<w;k+=1)if(u=f+12*k+2,n.getUint16(u,i)===274){u+=8,t=n.getUint16(u,i),n.setUint16(u,1,i);break}}}catch(U){console.error(U),t=1}return t},P.parseOrientation=function(a){var t=0,n=1,i=1;switch(a){case 2:n=-1;break;case 3:t=-180;break;case 4:i=-1;break;case 5:t=90,i=-1;break;case 6:t=90;break;case 7:t=90,n=-1;break;case 8:t=-90}return{rotate:t,scaleX:n,scaleY:i}},P.beforeDraw=function(a,t){var n=this.parsedOrientationInfo,i=n.rotate,r=n.scaleX,f=n.scaleY,w=this.file,u=this.options,x="transparent",c=t.width,b=t.height;switch(w.size>u.convertSize&&u.mimeType==="image/png"&&(x="#fff",u.mimeType="image/jpeg"),a.fillStyle=x,a.fillRect(0,0,c,b),s(u.beforeDraw)&&u.beforeDraw.call(this,a,t),a.save(),i){case 90:a.translate(c,0);break;case-90:a.translate(0,b);break;case-180:a.translate(c,b)}a.rotate(i*Math.PI/180),a.scale(r,f)},P.afterDraw=function(a,t){var n=this.options;s(n.afterDraw)&&n.afterDraw.call(this,a,t)},P.error=function(a){var t=this.options;if(!s(t.error))throw new Error(a);t.error.call(this,a)},P.success=function(a){var t,n,i=this.options,r=this.file,f=this.image,w=this.getExpectedEdge(),u=f.naturalHeight,x=f.naturalWidth;if(a&&a.size)if(!i.loose&&a.size>r.size&&!(w.width>x||w.height>u))console.warn("当前设置的是非宽松模式，压缩结果大于源图片，输出源图片"),a=r;else{var c=new Date;a.lastModified=c.getTime(),a.lastModifiedDate=c,a.name=r.name,a.name&&a.type!==r.type&&(a.name=a.name.replace(I,(t=a.type,(n=C(t)?t.substr(6):"")==="jpeg"&&(n="jpg"),"."+n)))}else console.warn("图片压缩出了点意外，输出源图片"),a=r;s(i.success)&&i.success.call(this,a)},m.file2DataUrl=function(a,t,n){var i=new FileReader;i.onload=function(){t(i.result)},i.onerror=function(){s(n)&&n("读取文件失败！")},i.readAsDataURL(a)},m.file2ArrayBuffer=function(a,t,n){var i=new FileReader;i.onload=function(r){t(r.target.result)},i.onerror=function(){s(n)&&n("读取文件失败！")},i.readAsArrayBuffer(a)},m.getStringFromCharCode=function(a,t,n){var i,r="";for(n+=t,i=t;i<n;i+=1)r+=String.fromCharCode(a.getUint8(i));return r},m.file2Image=function(a,t,n){var i=new Image,r=o.URL||o.webkitURL;if(o.navigator&&/(?:iPad|iPhone|iPod).*?AppleWebKit/i.test(o.navigator.userAgent)&&(i.crossOrigin="anonymous"),i.alt=a.name,i.onerror=function(){s(n)&&n("图片加载错误！")},r){var f=r.createObjectURL(a);i.onload=function(){t(i),r.revokeObjectURL(f)},i.src=f}else this.file2DataUrl(a,function(w){i.onload=function(){t(i)},i.src=w},n)},m.url2Image=function(a,t,n){var i=new Image;i.src=a,i.onload=function(){t(i)},i.onerror=function(){s(n)&&n("图片加载错误！")}},m.image2Canvas=function(a,t,n,i,r,f,w){var u=document.createElement("canvas"),x=u.getContext("2d");return u.width=f||a.naturalWidth,u.height=w||a.naturalHeight,s(i)&&i(x,u),x.save(),x.drawImage(a,0,0,t,n),x.restore(),s(r)&&r(x,u),u},m.canvas2DataUrl=function(a,t,n){return a.toDataURL(n||"image/jpeg",t)},m.dataUrl2Image=function(a,t,n){var i=new Image;i.onload=function(){t(i)},i.error=function(){s(n)&&n("图片加载错误！")},i.src=a},m.dataUrl2Blob=function(a,t){for(var n=a.split(",")[1],i=a.match(/^data:(.*?)(;base64)?,/)[1],r=atob(n),f=n.length,w=new Uint8Array(f),u=0;u<f;u++)w[u]=r.charCodeAt(u);return new Blob([w],{type:t||i})},m.blob2DataUrl=function(a,t,n){this.file2DataUrl(a,t,n)},m.blob2Image=function(a,t,n){this.file2Image(a,t,n)},m.canvas2Blob=function(a,t,n,i){var r=this;HTMLCanvasElement.prototype.toBlob||Object.defineProperty(HTMLCanvasElement.prototype,"toBlob",{value:function(f,w,u){var x=this.toDataURL(w,u);f(r.dataUrl2Blob(x))}}),a.toBlob(function(f){t(f)},i||"image/jpeg",n||.8)},m.upload=function(a,t,n){var i=new XMLHttpRequest,r=new FormData;r.append("file",t),i.onreadystatechange=function(){if(i.readyState!==4||i.status!==200)throw new Error(i);n&&n(i.responseText)},i.open("POST",a,!0),i.send(r)},m)m.hasOwnProperty(z)&&(S[z]=m[z])}]).default})})(He);var Bt=He.exports;Ye.exports=Bt;var jt=Ye.exports;const Vt=Et(jt);export{Vt as I,ht as S,Yt as a,pt as b,Ht as s};
