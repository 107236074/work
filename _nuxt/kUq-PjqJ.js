import{d as Q,j as X,i as R,s as W,b as Y,c as Z}from"./DIaV-xco.js";import{s as P,a as ee,I as te}from"./BPOvu2V4.js";import{b as ne,c as se,a as oe}from"./D9852THk.js";import{s as le}from"./8UUFJmno.js";import{c as ae,w as ie,p as ce,m as $}from"./BuLWTQJ-.js";import{d as J,r as A,c as de,o as K,Q as re,O as ue,z as l,N as me,t as L,v as O,A as f,x as w,G as pe,I as fe,E as y,B as V,C as ve,D as _e,_ as ge}from"./C8-PzCqa.js";import{F as z}from"./CugIzq5t.js";const[xe,G]=ae("text-ellipsis"),ye={rows:ce(1),dots:$("..."),content:$(""),expandText:$(""),collapseText:$(""),position:$("end")};var he=J({name:xe,props:ye,emits:["clickAction"],setup(s,{emit:F,slots:D}){const k=A(""),_=A(!1),N=A(!1),b=A();let a=!1;const i=de(()=>_.value?s.collapseText:s.expandText),C=r=>{if(!r)return 0;const e=r.match(/^\d*(\.\d*)?/);return e?Number(e[0]):0},M=()=>{if(!b.value||!b.value.isConnected)return;const r=window.getComputedStyle(b.value),e=document.createElement("div");return Array.prototype.slice.apply(r).forEach(o=>{e.style.setProperty(o,r.getPropertyValue(o))}),e.style.position="fixed",e.style.zIndex="-9999",e.style.top="-9999px",e.style.height="auto",e.style.minHeight="auto",e.style.maxHeight="auto",e.innerText=s.content,document.body.appendChild(e),e},T=()=>{const r=(d,E)=>{const{content:g,position:U,dots:h}=s,n=g.length,B=()=>{const m=(p,x)=>{if(x-p<=1)return U==="end"?g.slice(0,p)+h:h+g.slice(x,n);const v=Math.round((p+x)/2);return U==="end"?d.innerText=g.slice(0,v)+h+i.value:d.innerText=h+g.slice(v,n)+i.value,d.offsetHeight>E?U==="end"?m(p,v):m(v,x):U==="end"?m(v,x):m(p,v)};d.innerText=m(0,n)},S=(m,p)=>{if(m[1]-m[0]<=1&&p[1]-p[0]<=1)return g.slice(0,m[0])+h+g.slice(p[1],n);const x=Math.floor((m[0]+m[1])/2),v=Math.ceil((p[0]+p[1])/2);return d.innerText=s.content.slice(0,x)+s.dots+s.content.slice(v,n)+s.expandText,d.offsetHeight>=E?S([m[0],x],[v,p[1]]):S([x,m[1]],[p[0],v])},q=0+n>>1;return s.position==="middle"?d.innerText=S([0,q],[q,n]):B(),d.innerText},e=M();if(!e){a=!0;return}const{paddingBottom:t,paddingTop:o,lineHeight:c}=e.style,u=Math.ceil((Number(s.rows)+.5)*C(c)+C(o)+C(t));u<e.offsetHeight?(N.value=!0,k.value=r(e,u)):(N.value=!1,k.value=s.content),document.body.removeChild(e)},I=(r=!_.value)=>{_.value=r},j=r=>{I(),F("clickAction",r)},H=()=>{const r=D.action?D.action({expanded:_.value}):i.value;return l("span",{class:G("action"),onClick:j},[r])};return K(T),re(()=>{a&&(a=!1,T())}),ue([ie,()=>[s.content,s.rows,s.position]],T),Q({toggle:I}),()=>l("div",{ref:b,class:G()},[_.value?s.content:k.value,N.value?H():null])}});const we=s=>(ve("data-v-a0de21f4"),s=s(),_e(),s),ke={style:{width:"100%","padding-top":"12px"}},be={class:"history-list"},Ce=we(()=>w("div",{class:"title",style:{width:"100%","text-align":"left",color:"red","font-size":"13px","line-height":"2",padding:"4px","box-sizing":"border-box"}}," 说明:脱敏视频记录最多保留7天 过期后自动删除 请注意保存原始数据到本地",-1)),Te={class:"left"},Ue={class:"right"},Se={class:"title"},Ve={class:"desc"},Ae={class:"tools"},Ne=J({__name:"link",props:{ww:{type:Object,default:()=>{}}},setup(s){const F=s,D=e=>X("文件大小不能超过 100MB"),k=A([]),_=async()=>{const{Data:e}=await z.GetTmScriptListAjax({kind:"2"});e.length>0&&(k.value=e.map(t=>{const o=JSON.parse(t.Content);return o.Id=t.Id,o}))},N=e=>{ne({title:"操作确认",message:"是否要删除这个话术库内的内容"}).then(async()=>{await z.DetTmScriptAjax(e),R("删除成功"),await _()})},b=e=>window.open(e.link,"_blank"),a=me({link:"",files:[],title:"",desc:"",photos:[],imgUrl:""}),i=A({link:"",title:"",desc:"",imgUrl:""}),C=async e=>{if(i.value.link=a.link,i.value.title=a.title,i.value.desc=a.desc,i.value.imgUrl=a.imgUrl,e){const t=JSON.stringify(i.value);await z.SaveTmScriptAjax({Content:t,Kind:"2"}),R("保存成功"),await _()}I()},M=e=>{i.value.link=e.link,i.value.title=e.title,i.value.desc=e.desc,i.value.imgUrl=e.imgUrl,I()},T=e=>{let t="";const o="⁠",c="‌";return e.split("").forEach(d=>t+=o+d+c),t},I=()=>{F.ww.sendChatMessage({msgtype:"news",news:{link:i.value.link,title:T(i.value.title),desc:T(i.value.desc),imgUrl:i.value.imgUrl}})},j=e=>new Promise((t,o)=>new te({file:e,quality:.9,maxWidth:1920,maxHeight:1920,mimeType:"image/jpeg",loose:!0,redressOrientation:!0,success:function(c){t(c)},error(c){o(c)}})),H=async e=>{const t=W({message:"图片上传中...",forbidClick:!0}),o=await j(e.file),c=new File([o],e.file.name,{type:e.file.type});let u=new FormData;u.append("file",c);const{Data:d}=await z.UploadPhotoAjax(u);e.objectUrl=d.Url,a.imgUrl=d.Url,t.close()},r=async e=>{const t=W({message:"文件上传中...",forbidClick:!0,duration:0});let o=new FormData;o.append("file",e.file);const{Data:c}=await z.UploadFileAjax(o);console.log(c),e.objectUrl=c.Url,a.link=c.Url,t.close()};return K(()=>_()),(e,t)=>{const o=Y,c=ee,u=Z,d=se,E=oe,g=P,U=le,h=he;return L(),O("div",ke,[l(g,null,{default:f(()=>[l(o,{"label-align":"top",modelValue:y(a).title,"onUpdate:modelValue":t[0]||(t[0]=n=>y(a).title=n),border:!0,name:"title",label:"分享链接标题",placeholder:"请设置分享链接标题",rules:[{required:!0,message:"请设置分享链接标题"}]},null,8,["modelValue"]),l(o,{"label-align":"top",border:!0,modelValue:y(a).desc,"onUpdate:modelValue":t[1]||(t[1]=n=>y(a).desc=n),name:"desc",label:"分享链接描述",placeholder:"请设置分享链接描述",rules:[{required:!0,message:"请设置分享链接描述"}]},null,8,["modelValue"]),l(o,{name:"imgUrl",label:"分享链接图片",border:!0,"label-align":"top",rules:[{required:!0,message:"请设置分享链接图片"}]},{input:f(()=>[l(c,{modelValue:y(a).photos,"onUpdate:modelValue":t[2]||(t[2]=n=>y(a).photos=n),"max-count":1,"after-read":H},null,8,["modelValue"])]),_:1}),l(o,{"label-align":"top",modelValue:y(a).link,"onUpdate:modelValue":t[3]||(t[3]=n=>y(a).link=n),border:!0,name:"link",label:"分享链接网址",placeholder:"请设置分享链接网址",rules:[{required:!0,message:"请设置分享链接网址"}]},{"right-icon":f(()=>[l(c,{"max-count":1,accept:" video/*,audio/*","max-size":100*1024*1024,onOversize:D,"after-read":r},{default:f(()=>[l(u,{icon:"plus",type:"primary",size:"small"},{default:f(()=>[V("上传视频")]),_:1})]),_:1})]),_:1},8,["modelValue"]),l(E,{gutter:12},{default:f(()=>[l(d,{span:"12"},{default:f(()=>[l(u,{"native-type":"submit",type:"primary",style:{"margin-top":"12px"},block:"",onClick:t[4]||(t[4]=n=>C(!1))},{default:f(()=>[V("直接发送")]),_:1})]),_:1}),l(d,{span:"12"},{default:f(()=>[l(u,{"native-type":"submit",type:"success",style:{"margin-top":"12px"},block:"",onClick:t[5]||(t[5]=n=>C(!0))},{default:f(()=>[V("保存后发送")]),_:1})]),_:1})]),_:1})]),_:1}),w("div",be,[Ce,(L(!0),O(pe,null,fe(y(k),(n,B)=>(L(),O("div",{class:"item",key:B},[w("div",Te,[l(U,{src:n.imgUrl,mode:"aspectFill"},null,8,["src"])]),w("div",Ue,[w("div",Se,[l(h,{style:{"font-size":"16px","font-weight":"bold",color:"#000000","line-height":"2"},rows:"1",content:n.title},null,8,["content"])]),w("div",Ve,[l(h,{style:{"text-indent":"1em"},rows:"2",content:n.desc,"expand-text":"展开","collapse-text":"收起"},null,8,["content"])]),w("div",Ae,[l(u,{plain:"",hairline:"",type:"primary",onClick:S=>M(n),size:"small"},{default:f(()=>[V("发送")]),_:2},1032,["onClick"]),l(u,{plain:"",hairline:"",type:"success",style:{margin:"0 12px"},size:"small",onClick:S=>b(n)},{default:f(()=>[V("查看")]),_:2},1032,["onClick"]),l(u,{plain:"",hairline:"",type:"danger",size:"small",onClick:S=>N(n.Id)},{default:f(()=>[V("删除")]),_:2},1032,["onClick"])])])]))),128))])])}}}),je=ge(Ne,[["__scopeId","data-v-a0de21f4"]]);export{je as default};
